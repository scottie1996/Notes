# 输入一个url到浏览器页面展示都经历了哪些过程

## 1 输入网址

 当我们开始在浏览器中输入网址的时候，浏览器其实就已经在智能的匹配可能得 url 了，他会从历史记录，书签等地方，找到已经输入的字符串可能对应的 url，然后给出智能提示，让你可以补全url地址。对于 google的chrome 的浏览器，他甚至会直接从缓存中把网页展示出来，就是说，你还没有按下 enter，页面就出来了。

## 2 缓存解析

浏览器获取了这个url，当然就去解析了，它先去缓存当中看看有没有，从 **浏览器缓存-系统缓存-路由器缓存** 当中查看，如果有从缓存当中显示页面，然后没有那就进行步骤三；
缓存就是把你之前访问的web资源，比如一些js，css，图片什么的保存在你本机的内存或者磁盘当中。

## 3 域名解析（浏览器查找域名的 IP 地址）

在发送http之前，需要进行DNS解析即域名解析。

DNS（Domain Name System，域名系统），因特网上作为域名和[IP地址](http://baike.baidu.com/item/IP地址)相互映射的一个[分布式数据库](http://baike.baidu.com/item/分布式数据库)，能够使用户更方便的访问[互联网](http://baike.baidu.com/item/互联网)，而不用去记住能够被机器直接读取的IP数串。通过[主机](http://baike.baidu.com/item/主机)名，最终得到该主机名对应的IP地址的过程叫做域名解析（或主机名解析）。

　　通俗的讲，我们更习惯于记住一个网站的名字，比如www.baidu.com,而不是记住它的ip地址，比如：167.23.10.2。而计算机更擅长记住网站的ip地址，而不是像www.baidu.com等链接。因为，DNS就相当于一个电话本，比如你要找www.baidu.com这个域名，那我翻一翻我的电话本，我就知道，哦，它的电话（ip）是167.23.10.2

1. 请求一旦发起，浏览器首先要做的事情就是解析这个域名，一般来说，浏览器会首先查看本地硬盘的 hosts 文件，看看其中有没有和这个域名对应的规则，如果有的话就直接使用 hosts 文件里面的 ip 地址。
2.  如果在本地的 hosts 文件没有能够找到对应的 ip 地址，浏览器会**发出一个 DNS请求到本地DNS服务器** 。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。
3. 查询你输入的网址的DNS请求到达本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果，此过程是递归的方式进行查询。如果没有，本地DNS服务器还要向DNS根服务器进行查询。
4. 根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。这种过程是迭代的过程。
5. 本地DNS服务器继续向域服务器发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。
6. 最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。

<img src="https://raw.githubusercontent.com/scottie1996/PicGo/master/img/703023-20170411102207641-176133223.jpg" alt="img"  />

## 4 传输层TCP连接，三次握手

<img src="https://images2015.cnblogs.com/blog/703023/201704/703023-20170411102459204-619227310.jpg" alt="img" style="zoom: 50%;" />

（1）客户端向服务器发送连接请求报文；
（2）服务器端接受客户端发送的连接请求后后回复ACK报文，并为这次连接分配资源。
（3）客户端接收到ACK报文后也向服务器端发生ACK报文，并分配资源。

这样TCP连接就建立了。
在此之后，浏览器开始向服务器发送http请求，请求数据包。请求信息包含一个头部和一个请求体。

然后到了网络层，通过IP协议将IP地址封装为IP数据报；然后此时会用到ARP协议，主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址，找到目的MAC地址；

接下来到了数据链路层，把网络层交下来的IP数据报添加首部和尾部，封装为MAC帧，现在根据目的mac开始建立TCP连接，三次握手，接收端在收到物理层上交的比特流后，根据首尾的标记，识别帧的开始和结束，将中间的数据部分上交给网络层，然后层层向上传递到应用层；

## 5 **服务器收到请求**

服务器收到浏览器发送的请求信息，返回一个响应头和一个响应体。

## 6  页面渲染

浏览器收到服务器发送的响应头和响应体，进行客户端渲染，生成Dom树、解析css样式、js交互。



## 知识扩展

#### DNS查询的两种方式：递归查询和迭代查询

**1、递归解析**

当局部DNS服务器自己不能回答客户机的DNS查询时，它就需要向其他DNS服务器进行查询。此时有两种方式，如图所示的是递归方式。局部DNS服务器自己负责向其他DNS服务器进行查询，一般是先向该域名的根域服务器查询，再由根域名服务器一级级向下查询。最后得到的查询结果返回给局部DNS服务器，再由局部\*DNS服务器返回给客户端。

![img](https://raw.githubusercontent.com/scottie1996/PicGo/master/img/703023-20170411102310516-353035852.png)

**2、迭代解析**

　　当局部*DNS服务器自己不能回答客户机的\*DNS查询时，也可以通过迭代查询的方式进行解析，如图\*所示。局部\*DNS服务器不是自己向其他\*DNS服务器进行查询，而是把能解析该域名的其他\*DNS服务器的\*IP地址返回给客户端\*DNS程序，客户端\*DNS程序再继续向这些\*DNS服务器进行查询，直到得到查询结果为止。也就是说，迭代解析只是帮你找到相关的服务器而已，而不会帮你去查。比如说：baidu.com的服务器ip地址在192.168.4.5这里，你自己去查吧，本人比较忙，只能帮你到这里了。

![img](https://raw.githubusercontent.com/scottie1996/PicGo/master/img/703023-20170411102310516-353035852.png)

#### DNS域名称空间的组织方式

 我们在前面有说到根DNS服务器，域DNS服务器，这些都是DNS域名称空间的组织方式。按其功能命名空间中用来描述 DNS 域名称的五个类别的介绍详见下表中，以及与每个名称类型的示例

![img](https://images2015.cnblogs.com/blog/703023/201704/703023-20170411102350141-1461370836.jpg)

#### DNS负载均衡

　　当一个网站有足够多的用户的时候，假如每次请求的资源都位于同一台机器上面，那么这台机器随时可能会蹦掉。处理办法就是用DNS负载均衡技术，它的原理是在DNS服务器中为同一个主机名配置多个IP地址,在应答DNS查询时,DNS服务器对每个查询将以DNS文件中主机记录的IP地址按顺序返回不同的解析结果,将客户端的访问引导到不同的机器上去,使得不同的客户端访问不同的服务器,从而达到负载均衡的目的｡例如可以根据每台机器的负载量，该机器离用户地理位置的距离等等。